<?xml version="1.0" encoding="UTF-8"?><record_update table="x_8821_code_code_snippet">
    <x_8821_code_code_snippet action="INSERT_OR_UPDATE">
        <applicable_in_application_files/>
        <applicable_in_context>server</applicable_in_context>
        <client_script><![CDATA[// To make code snippet able to test "Sample Input":

// fnName(arg1, arg2, arg3);
// function fnName(arg1, arg2, arg3) {
    // Code to execute
    // return <result>;
// }]]></client_script>
        <css/>
        <description>A useful class many people don't know is available to be used is "GlideScopedEvaluator" in the Glide library (similar to an "eval()" encapsulation statement ran inside a Widget Server Script).  This useful function can be run against a GlideElement that contains at least one field of type "Script".  Despite it's misleading name, it is able to be run inside of the Global application as well as Scoped applications.&#13;
&#13;
You can add a "Script" field type on any table.  (It is advised to call the database field name "run_this_script", in accordance with other ServiceNow tables.)  In this field you can contain code unique to the record, and you can make this code do anything to the ServiceNow database that any other server-side code snippet can do.  The true advantage here is that scripts are able to be run at the record level,  not the table level as typical with other configurations.&#13;
</description>
        <jelly_script/>
        <link/>
        <name>[Revisit] How to Use GlideScopedEvaluator to Execute Conditional Scripts</name>
        <option_schema/>
        <sample_input>{&#13;
"arg1":  "val1",&#13;
"arg2":  "val2",&#13;
"arg3":  "val3"&#13;
// Add additional arguments as needed.&#13;
// Please delete these comments before executing.&#13;
}</sample_input>
        <sample_output_client/>
        <sample_output_server/>
        <server_script><![CDATA[// To make code snippet able to test "Sample Input":

// fnName(arg1, arg2, arg3);
// function fnName(arg1, arg2, arg3) {
    // Code to execute
    // return <result>;
// }

function retrieveVariableValues(questionSysID, question) {  
  
    // Iterate through matching variables in HTML body  
    var variables = question.match(/{.*?}/gi);  
    for (var v in variables) {  
          
        // Lookup question's association to question variable  
        var questionVariableQuestionsGR = new GlideRecord("x_icir_ipo_m2m_question_var_questions");  
        questionVariableQuestionsGR.addQuery("question", questionSysID);  
        questionVariableQuestionsGR.addQuery("question_variable.name", variables[v].replace("{", "").replace("}", ""));  
        questionVariableQuestionsGR.query();  
        if (questionVariableQuestionsGR.next()) {  
  
            // Evaluate question variable and replace braced text with value from script field (will be evaluated)  
            var questionVariableGR = new GlideRecord("x_icir_ipo_question_variable");  
            questionVariableGR.addQuery("sys_id", questionVariableQuestionsGR.question_variable);  
            questionVariableGR.query();  
            if (questionVariableGR.next()) {  
  
                var evaluator = new GlideScopedEvaluator();  
                evaluator.putVariable('object', {  
                    'patientSysID': data.patientSysID  
                });  
  
                var value = evaluator.evaluateScript(questionVariableGR, 'return_value_script', {x: {}});  
  
                question = question.replace(variables[v], value);  
            }  
        }  
    }  
  
    return question;  
} 
]]></server_script>
        <sys_class_name>x_8821_code_code_snippet</sys_class_name>
        <sys_created_by>alex.chansuthus@infocenter.io</sys_created_by>
        <sys_created_on>2020-09-29 20:03:25</sys_created_on>
        <sys_id>ee65e0311b2f1050fbdb78cf034bcb4c</sys_id>
        <sys_mod_count>2</sys_mod_count>
        <sys_name>[Revisit] How to Use GlideScopedEvaluator to Execute Conditional Scripts</sys_name>
        <sys_package display_value="Code Search and Snip" source="x_8821_code">0f7b73c4dba433007d159235ca96197c</sys_package>
        <sys_policy/>
        <sys_scope display_value="Code Search and Snip">0f7b73c4dba433007d159235ca96197c</sys_scope>
        <sys_update_name>x_8821_code_code_snippet_ee65e0311b2f1050fbdb78cf034bcb4c</sys_update_name>
        <sys_updated_by>mike.cornell@infocenter.io</sys_updated_by>
        <sys_updated_on>2020-10-23 03:09:56</sys_updated_on>
        <template/>
    </x_8821_code_code_snippet>
</record_update>
